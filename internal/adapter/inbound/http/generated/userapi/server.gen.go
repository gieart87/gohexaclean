// Package userapi provides primitives to interact with the openapi HTTP API.
//
// Code generated by github.com/deepmap/oapi-codegen version v1.16.3 DO NOT EDIT.
package userapi

import (
	"fmt"
	"net/url"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/oapi-codegen/runtime"
	openapi_types "github.com/oapi-codegen/runtime/types"
)

const (
	BearerAuthScopes = "BearerAuth.Scopes"
)

// CreateUserRequest defines model for CreateUserRequest.
type CreateUserRequest struct {
	// Email User email address
	Email openapi_types.Email `json:"email"`

	// Name User full name
	Name string `json:"name"`

	// Password User password
	Password string `json:"password"`
}

// ErrorResponse defines model for ErrorResponse.
type ErrorResponse struct {
	// ErrorCode Error code identifier
	ErrorCode *string `json:"error_code,omitempty"`

	// Errors Validation errors (each field can have multiple error messages)
	Errors  *map[string][]string `json:"errors"`
	Message *string              `json:"message,omitempty"`
	Meta    *struct {
		RequestId *openapi_types.UUID `json:"request_id,omitempty"`
		Timestamp *time.Time          `json:"timestamp,omitempty"`
	} `json:"meta,omitempty"`
	Success *bool `json:"success,omitempty"`
}

// LoginRequest defines model for LoginRequest.
type LoginRequest struct {
	// Email User email address
	Email openapi_types.Email `json:"email"`

	// Password User password
	Password string `json:"password"`
}

// LoginResponse defines model for LoginResponse.
type LoginResponse struct {
	Data *struct {
		// Token JWT access token
		Token *string `json:"token,omitempty"`
		User  *User   `json:"user,omitempty"`
	} `json:"data,omitempty"`
	Message *string `json:"message,omitempty"`
	Meta    *struct {
		RequestId *openapi_types.UUID `json:"request_id,omitempty"`
		Timestamp *time.Time          `json:"timestamp,omitempty"`
	} `json:"meta,omitempty"`
	Success *bool `json:"success,omitempty"`
}

// PaginatedUserResponse defines model for PaginatedUserResponse.
type PaginatedUserResponse struct {
	Data    *[]User `json:"data,omitempty"`
	Message *string `json:"message,omitempty"`
	Meta    *struct {
		Pagination *struct {
			Page       *int   `json:"page,omitempty"`
			PerPage    *int   `json:"per_page,omitempty"`
			Total      *int64 `json:"total,omitempty"`
			TotalPages *int   `json:"total_pages,omitempty"`
		} `json:"pagination,omitempty"`
		RequestId *openapi_types.UUID `json:"request_id,omitempty"`
		Timestamp *time.Time          `json:"timestamp,omitempty"`
	} `json:"meta,omitempty"`
	Success *bool `json:"success,omitempty"`
}

// SuccessResponse defines model for SuccessResponse.
type SuccessResponse struct {
	Data    *map[string]interface{} `json:"data"`
	Message *string                 `json:"message,omitempty"`
	Meta    *struct {
		RequestId *openapi_types.UUID `json:"request_id,omitempty"`
		Timestamp *time.Time          `json:"timestamp,omitempty"`
	} `json:"meta,omitempty"`
	Success *bool `json:"success,omitempty"`
}

// UpdateUserRequest defines model for UpdateUserRequest.
type UpdateUserRequest struct {
	// Name Updated user name
	Name string `json:"name"`
}

// User defines model for User.
type User struct {
	// CreatedAt User creation timestamp
	CreatedAt *time.Time `json:"created_at,omitempty"`

	// Email User email address
	Email *openapi_types.Email `json:"email,omitempty"`

	// Id Unique user identifier
	Id *openapi_types.UUID `json:"id,omitempty"`

	// IsActive User active status
	IsActive *bool `json:"is_active,omitempty"`

	// Name User full name
	Name *string `json:"name,omitempty"`

	// UpdatedAt Last update timestamp
	UpdatedAt *time.Time `json:"updated_at,omitempty"`
}

// UserResponse defines model for UserResponse.
type UserResponse struct {
	Data    *User   `json:"data,omitempty"`
	Message *string `json:"message,omitempty"`
	Meta    *struct {
		RequestId *openapi_types.UUID `json:"request_id,omitempty"`
		Timestamp *time.Time          `json:"timestamp,omitempty"`
	} `json:"meta,omitempty"`
	Success *bool `json:"success,omitempty"`
}

// ListUsersParams defines parameters for ListUsers.
type ListUsersParams struct {
	// Page Page number
	Page *int `form:"page,omitempty" json:"page,omitempty"`

	// Limit Items per page
	Limit *int `form:"limit,omitempty" json:"limit,omitempty"`
}

// UpdateUserJSONRequestBody defines body for UpdateUser for application/json ContentType.
type UpdateUserJSONRequestBody = UpdateUserRequest

// LoginJSONRequestBody defines body for Login for application/json ContentType.
type LoginJSONRequestBody = LoginRequest

// RegisterJSONRequestBody defines body for Register for application/json ContentType.
type RegisterJSONRequestBody = CreateUserRequest

// ServerInterface represents all server handlers.
type ServerInterface interface {
	// List users
	// (GET /admin/users)
	ListUsers(c *fiber.Ctx, params ListUsersParams) error
	// Delete user
	// (DELETE /admin/users/{id})
	DeleteUser(c *fiber.Ctx, id openapi_types.UUID) error
	// Get user by ID
	// (GET /admin/users/{id})
	GetUserById(c *fiber.Ctx, id openapi_types.UUID) error
	// Update user
	// (PUT /admin/users/{id})
	UpdateUser(c *fiber.Ctx, id openapi_types.UUID) error
	// User login
	// (POST /auth/login)
	Login(c *fiber.Ctx) error
	// Register new user
	// (POST /auth/register)
	Register(c *fiber.Ctx) error
}

// ServerInterfaceWrapper converts contexts to parameters.
type ServerInterfaceWrapper struct {
	Handler ServerInterface
}

type MiddlewareFunc fiber.Handler

// ListUsers operation middleware
func (siw *ServerInterfaceWrapper) ListUsers(c *fiber.Ctx) error {

	var err error

	c.Context().SetUserValue(BearerAuthScopes, []string{})

	// Parameter object where we will unmarshal all parameters from the context
	var params ListUsersParams

	var query url.Values
	query, err = url.ParseQuery(string(c.Request().URI().QueryString()))
	if err != nil {
		return fiber.NewError(fiber.StatusBadRequest, fmt.Errorf("Invalid format for query string: %w", err).Error())
	}

	// ------------- Optional query parameter "page" -------------

	err = runtime.BindQueryParameter("form", true, false, "page", query, &params.Page)
	if err != nil {
		return fiber.NewError(fiber.StatusBadRequest, fmt.Errorf("Invalid format for parameter page: %w", err).Error())
	}

	// ------------- Optional query parameter "limit" -------------

	err = runtime.BindQueryParameter("form", true, false, "limit", query, &params.Limit)
	if err != nil {
		return fiber.NewError(fiber.StatusBadRequest, fmt.Errorf("Invalid format for parameter limit: %w", err).Error())
	}

	return siw.Handler.ListUsers(c, params)
}

// DeleteUser operation middleware
func (siw *ServerInterfaceWrapper) DeleteUser(c *fiber.Ctx) error {

	var err error

	// ------------- Path parameter "id" -------------
	var id openapi_types.UUID

	err = runtime.BindStyledParameter("simple", false, "id", c.Params("id"), &id)
	if err != nil {
		return fiber.NewError(fiber.StatusBadRequest, fmt.Errorf("Invalid format for parameter id: %w", err).Error())
	}

	c.Context().SetUserValue(BearerAuthScopes, []string{})

	return siw.Handler.DeleteUser(c, id)
}

// GetUserById operation middleware
func (siw *ServerInterfaceWrapper) GetUserById(c *fiber.Ctx) error {

	var err error

	// ------------- Path parameter "id" -------------
	var id openapi_types.UUID

	err = runtime.BindStyledParameter("simple", false, "id", c.Params("id"), &id)
	if err != nil {
		return fiber.NewError(fiber.StatusBadRequest, fmt.Errorf("Invalid format for parameter id: %w", err).Error())
	}

	c.Context().SetUserValue(BearerAuthScopes, []string{})

	return siw.Handler.GetUserById(c, id)
}

// UpdateUser operation middleware
func (siw *ServerInterfaceWrapper) UpdateUser(c *fiber.Ctx) error {

	var err error

	// ------------- Path parameter "id" -------------
	var id openapi_types.UUID

	err = runtime.BindStyledParameter("simple", false, "id", c.Params("id"), &id)
	if err != nil {
		return fiber.NewError(fiber.StatusBadRequest, fmt.Errorf("Invalid format for parameter id: %w", err).Error())
	}

	c.Context().SetUserValue(BearerAuthScopes, []string{})

	return siw.Handler.UpdateUser(c, id)
}

// Login operation middleware
func (siw *ServerInterfaceWrapper) Login(c *fiber.Ctx) error {

	return siw.Handler.Login(c)
}

// Register operation middleware
func (siw *ServerInterfaceWrapper) Register(c *fiber.Ctx) error {

	return siw.Handler.Register(c)
}

// FiberServerOptions provides options for the Fiber server.
type FiberServerOptions struct {
	BaseURL     string
	Middlewares []MiddlewareFunc
}

// RegisterHandlers creates http.Handler with routing matching OpenAPI spec.
func RegisterHandlers(router fiber.Router, si ServerInterface) {
	RegisterHandlersWithOptions(router, si, FiberServerOptions{})
}

// RegisterHandlersWithOptions creates http.Handler with additional options
func RegisterHandlersWithOptions(router fiber.Router, si ServerInterface, options FiberServerOptions) {
	wrapper := ServerInterfaceWrapper{
		Handler: si,
	}

	for _, m := range options.Middlewares {
		router.Use(m)
	}

	router.Get(options.BaseURL+"/admin/users", wrapper.ListUsers)

	router.Delete(options.BaseURL+"/admin/users/:id", wrapper.DeleteUser)

	router.Get(options.BaseURL+"/admin/users/:id", wrapper.GetUserById)

	router.Put(options.BaseURL+"/admin/users/:id", wrapper.UpdateUser)

	router.Post(options.BaseURL+"/auth/login", wrapper.Login)

	router.Post(options.BaseURL+"/auth/register", wrapper.Register)

}
